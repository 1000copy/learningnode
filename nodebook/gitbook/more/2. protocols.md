## 更多协议

想要和他人协作，我必须有远程仓库，这样我才可以推送和拉取代码的变更。在上一节，我们已经通过一个共享仓库作为中介，以本地协议的通讯方式，达成两人（多人）的代码协作了。

git支持4种协议，包括本地协议、HTTP协议、Git协议、SSH协议。我们继续看看Git协议。

## Git 协议

通过Git协议来托管仓库是内置于git-daemon命令之内。因此使用它来做测试和验证仓库的托管是非常方便的。执行 git-daemon，会启动一个监守程序，等待采用git协议来连接的客户端，这些连接过来的客户端可以访问指定目录下的仓库。

假设我们在~/git目录内已经存在一个共享仓库，那么


    cd ~/git
    git daemon --verbose --export-all --base-path=. --enable=receive-pack

这里的新命令git-daemon需要做些解释。参数说明：

    --base-path=. 指定基础目录，客户端连接指定的目录都相对于此目录来定位目录。当前命令行内的基础目录就是 ~/git 
    --enable=receive-
    --export-all 公开全部仓库

启动了git监守程序，就可以在客户端运行git-clone来拉取仓库了：

	git clone git://localhost/repo.git

我们使用的主机地址为localhost，就是意味着拉取的仓库位于本机；你可以使用IP地址，就可以访问其他主机的托管仓库了。

## SSH 协议

以 OS X 为例，首先激活sshd：

	sudo systemsetup -setremotelogin on

随后远程登录到主机（为了演示和测试的方便，远程主机使用localhost来做模拟），并输入密码：

	ssh localhhost

然后创建一个共享仓库：

	mkdir gitshared.git
	cd gitshared.git
	git init --bare --shared
	exit

这时我们已经准备好了一个空仓库，可以在另外一个主机（也是本机）做克隆了。

	git clone ssh://localhost/Users/lcjun/gitshared.git

使用git-remote来查询远程仓库：

 	$git remote -v
	origin	ssh://localhost/Users/lcjun/gitshared (fetch)
	origin	ssh://localhost/Users/lcjun/gitshared (push)

即可验证命令确实有效的被执行了，ssh远程仓库也已经和本地关联起来了。

## HTTP

希望可以使用

    git clone http://git.example.com/repo.git 

的形式，以http协议方法访问主机上的repo.git 仓库。留意URL的第一部分是http，而不是ssh，或者git。

假设仓库以 /var/www/git 存放。

使用apache+git-httpbackend 可以（一个cgi）完成HTTP git 服务器的搭建。

    mkdir -p /var/www/git/repo.git
    cd /var/www/git/repo.git
    git init --bare --shared

# 确保apache 模块已经启动cgi,env,alias

    LoadModule cgi_module libexec/apache2/mod_cgi.so
    LoadModule env_module libexec/apache2/mod_env.so
    LoadModule alias_module libexec/apache2/mod_alias.so

# 修改hosts文件，支持主机访问

    192.168.3.11   git.example.com

# apache config 加入虚拟主机

    <VirtualHost 192.168.3.11:80>
        DocumentRoot /var/www/git
        ServerName git.example.com
        <Directory "/var/www/git">
            Options +Indexes
            Require all granted
        </Directory>
        <Directory "/usr/local/Cellar/git/2.4.1/libexec/git-core/">
           Options ExecCGI Indexes
           Order allow,deny
           Allow from all
           Require all granted
        </Directory>
        SetEnv GIT_HTTP_EXPORT_ALL
        SetEnv GIT_PROJECT_ROOT /var/www/git
        ScriptAlias /git/ /usr/local/Cellar/git/2.4.1/libexec/git-core/git-http-backend/
    </VirtualHost>

如果留空 GIT_HTTP_EXPORT_ALL 这个环境变量，Git 将只对无授权客户端提供带 git-daemon-export-ok 文件的版本库，就像 Git 守护进程一样。

GIT_PROJECT_ROOT 必须设置，这个值是 git-http-backend 需要的，有了它，cgi就知道如何定位基础目录了。

必须把 git-http-backend 所在的目录（/usr/local/Cellar/git/2.4.1/libexec/git-core）设置为可以执行CGI（ExecCGI）。


## 折腾了几个小时，原来是没有执行  git update-server-info 

  sudo git update-server-info 
## bingo
    
    git clone http://git.example.com/repo.git
    Cloning into 'repo'...
    warning: You appear to have cloned an empty repository.
    Checking connectivity... done.
    

#查看错误


sudo tail /private/var/log/apache2/error_log


#重启apache




 sudo apachectl restart
#apache conf 的位置
/etc/apache2/httpd.conf 
#找到 git backend 的方法

$ find / -name git-http-backend  2>/dev/null

#找到apache 用户的方法
 $ ps aux | egrep '(apache|httpd)'. 
#找到apache用户组的方法：

$ id user-name
user-name 换成apache 用户名


http://www.parallelsymmetry.com/howto/git.jsp

# Git package broken in 10.11 El Capitan
brew reinstall git
...
==> make prefix=/usr/local/Cellar/git/2.4.3 sysconfdir=/usr/local/etc CC=clang C
./git-compat-util.h:219:10: fatal error: 'openssl/ssl.h' file not found
#include <openssl/ssl.h>
         ^
solution:


brew reinstall git --with-brewed-openssl


http://stackoverflow.com/questions/26734933/how-to-set-up-git-over-http


http://stackoverflow.com/questions/11983169/a2enmod-doesnt-work-on-mac-os-x-mountain-lion


# 修改配置

vim /etc/apache2/users/USERNAME.conf

<Directory "/Users/USERNAME/Sites/">
Options Indexes Multiviews
AllowOverride AuthConfig Limit
Order allow,deny
Allow from all
</Directory>

$ sudo apachectl start

$ curl localhost
<html><body><h1>It works!</h1></body></html>


troubleshooting on OS X EI Captain

##错误的配置
 apachectl configtest
AH00526: Syntax error on line 20 of /private/etc/apache2/extra/httpd-mpm.conf:
Invalid command 'LockFile', perhaps misspelled or defined by a module not included in the server configuration
##解决

    
cd /etc/apache2/extra


// and restored the httpd-mpm.conf file from before I loaded El Capitan. I used these commands:


$sudo mv httpd-mpm.conf httpd-mpm.conf.elcapitan
$sudo mv httpd-mpm.conf~orig httpd-mpm.conf
and entered the commands:

$sudo apachectl restart
$apachectl configtest
Syntax OK
和我的风格有点像。

沉浸式学 Git  http://igit.linuxtoy.org/contents.html

GOOGLE :   Git Cookbook – Serving git smart http protocol and a web